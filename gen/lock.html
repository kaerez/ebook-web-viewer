<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlipBook Activator Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Highlight.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
    
    <style>
        body { background-color: #0f172a; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .input-dark { background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(255,255,255,0.1); color: #e2e8f0; }
        .input-dark:focus { outline: none; border-color: #3b82f6; ring: 2px; }
        
        /* Toggle Switch */
        .toggle-checkbox:checked { right: 0; border-color: #3b82f6; }
        .toggle-checkbox:checked + .toggle-label { background-color: #3b82f6; }
    </style>
</head>
<body class="min-h-screen text-slate-300 flex items-center justify-center p-4">

    <div class="glass w-full max-w-4xl rounded-2xl shadow-2xl overflow-hidden flex flex-col md:flex-row">
        
        <!-- LEFT PANEL: CONTROLS -->
        <div class="w-full md:w-1/2 p-8 border-r border-white/10 flex flex-col gap-6">
            
            <div>
                <h1 class="text-3xl font-bold text-white mb-2">Activator Studio</h1>
                <p class="text-sm text-slate-400">Generate secure offline activation scripts for FlipBook.</p>
            </div>

            <!-- Domain Locking -->
            <div class="space-y-3">
                <div class="flex justify-between items-center">
                    <label class="text-sm font-semibold text-white tracking-wide">Domain Locking</label>
                    <span class="text-xs text-slate-500 bg-slate-800 px-2 py-1 rounded">Optional</span>
                </div>
                <textarea id="domains" rows="3" placeholder="*.a.com (subdomains only)&#10;a.co.?? (wildcard char)&#10;example.com" 
                    class="input-dark w-full rounded-lg p-3 text-sm font-mono placeholder-slate-600 transition-all"></textarea>
                <p class="text-xs text-slate-500">Supports wildcards: <code>*</code> (any), <code>?</code> (single char). Inputs are automatically lowercased.</p>
            </div>

            <!-- Obfuscation Toggle -->
            <div class="flex items-center justify-between bg-slate-800/50 p-4 rounded-lg border border-white/5">
                <div>
                    <h3 class="text-sm font-semibold text-white">Heavy Obfuscation</h3>
                    <p class="text-xs text-slate-400 mt-1">Encrypt code to prevent tampering</p>
                </div>
                <div class="relative inline-block w-12 mr-2 align-middle select-none transition duration-200 ease-in">
                    <input type="checkbox" name="toggle" id="obfuscate" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-300 left-0"/>
                    <label for="obfuscate" class="toggle-label block overflow-hidden h-6 rounded-full bg-slate-700 cursor-pointer"></label>
                </div>
            </div>

            <!-- Generate Button -->
            <button onclick="generateScript()" class="mt-auto w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-900/20 transition-all transform active:scale-[0.98] flex items-center justify-center gap-2 group">
                <svg class="w-5 h-5 group-hover:rotate-12 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                Generate Script
            </button>

        </div>

        <!-- RIGHT PANEL: OUTPUT -->
        <div class="w-full md:w-1/2 bg-slate-900/50 flex flex-col">
            <div class="p-4 border-b border-white/5 flex justify-between items-center bg-slate-900">
                <span class="text-xs font-mono text-blue-400">output.js</span>
                <button onclick="copyCode()" class="text-xs text-slate-400 hover:text-white flex items-center gap-1 transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                    Copy
                </button>
            </div>
            
            <div class="relative flex-grow overflow-hidden group">
                <pre class="h-full w-full m-0"><code id="output-code" class="language-javascript h-full w-full p-6 text-sm overflow-auto custom-scrollbar">/* 1. Configure settings on the left.
   2. Click 'Generate Script'.
   3. Paste the result BEFORE your flipbook loads.
*/</code></pre>
            </div>
            
            <div class="p-4 border-t border-white/5 bg-slate-900/80 text-center">
                <p class="text-xs text-slate-500" id="status-bar">Ready to generate</p>
            </div>
        </div>

    </div>

    <script>
        // --- 1. THE CORE PATCH LOGIC ---
        // Exactly matching the requested indentation and logic
        const CORE_PATCH_SOURCE = `    (function() {
        const originalFetch = window.fetch;
        window.fetch = function(url, options) {
            if (url && typeof url === 'string' && url.includes('check.php')) {
                return Promise.resolve({
                    ok: true,
                    status: 200,
                    json: async () => ({ success: true, active: true })
                });
            }
            return originalFetch.apply(this, arguments);
        };
    })();`;

        // --- 2. GENERATOR ENGINE ---
        function generateScript() {
            const domainInput = document.getElementById('domains').value.trim();
            const useObfuscation = document.getElementById('obfuscate').checked;
            const statusBar = document.getElementById('status-bar');

            let finalCode = CORE_PATCH_SOURCE;

            // Step A: Domain Locking with Wildcard Logic
            if (domainInput) {
                const domains = domainInput.split('\n')
                    // FORCE LOWERCASE HERE to ensure consistency
                    .map(d => d.trim().toLowerCase())
                    .filter(d => d.length > 0);
                
                if (domains.length > 0) {
                    const domainListStr = JSON.stringify(domains);
                    finalCode = wrapWithDomainCheck(finalCode, domainListStr);
                    statusBar.textContent = `Generated for ${domains.length} specific domain(s).`;
                } else {
                    statusBar.textContent = "Generated for ALL domains (Empty list provided).";
                }
            } else {
                statusBar.textContent = "Generated for ALL domains.";
            }

            // Step B: Obfuscation
            if (useObfuscation) {
                finalCode = obfuscateCode(finalCode);
                statusBar.textContent += " (Obfuscated)";
            }

            // Step C: Render
            finalCode = `<script>\n${finalCode}\n<\/script>`;
            
            const codeBlock = document.getElementById('output-code');
            codeBlock.textContent = finalCode;
            delete codeBlock.dataset.highlighted; // Reset highlight.js
            hljs.highlightElement(codeBlock);
        }

        // --- 3. LOGIC HELPERS ---

        function wrapWithDomainCheck(code, domainArrayStr) {
            // Updated wrapper with Wildcard (*) and Single Char (?) support
            // Includes no comments or logging
            return `
(function(){
    var p = ${domainArrayStr};
    var h = window.location.hostname.toLowerCase();
    var c = function(pt, ht) {
        var r = pt.replace(/[.+^=\${}()|[\\]\\\\]/g, "\\\\$&")
                  .replace(/\\?/g, ".")
                  .replace(/\\*/g, ".*");
        return new RegExp("^" + r + "$").test(ht);
    };
    var a = p.some(function(pt) { return c(pt.toLowerCase(), h); });
    if (a) {
${code}
    }
})();`;
        }

        function obfuscateCode(source) {
            // A custom, heavy hex-encoding obfuscator
            
            // 1. Minify simply by removing extra whitespace/newlines
            let minified = source.replace(/\s+/g, ' ').trim();
            
            // 2. Hex Encode the string
            let hex = '';
            for (let i = 0; i < minified.length; i++) {
                hex += '%' + minified.charCodeAt(i).toString(16).padStart(2, '0');
            }

            // 3. Generate random variable names
            const randVar = () => '_0x' + Math.random().toString(16).substr(2, 4);
            const varDecode = randVar();
            const varPayload = randVar();
            const varExec = randVar();

            // 4. Create the self-executing wrapper
            // This wrapper decodes the URI component (hex) and executes it using Function constructor
            // NOTE: REMOVED ALL COMMENTS AND NEWLINES FROM TEMPLATE
            return `(function(${varDecode},${varPayload}){var ${varExec}=function(s){return decodeURIComponent(s);};try{new Function(${varExec}(${varPayload}))();}catch(e){}})(window,"${hex}");`;
        }

        function copyCode() {
            const code = document.getElementById('output-code').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const statusBar = document.getElementById('status-bar');
                const originalText = statusBar.textContent;
                statusBar.textContent = "Copied to clipboard!";
                statusBar.classList.add("text-green-400");
                setTimeout(() => {
                    statusBar.textContent = originalText;
                    statusBar.classList.remove("text-green-400");
                }, 2000);
            });
        }

        // Initialize highlighter
        hljs.highlightAll();
    </script>
</body>
</html>
